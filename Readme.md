# DevOps Stage 4 - Terraform & Ansible Setup

## Overview
This project automates the provisioning and configuration of an AWS EC2 instance for deploying a microservices-based TODO application using Terraform and Ansible. Terraform provisions the infrastructure, and Ansible configures the instance and deploys the application.

---

## Prerequisites
Before running the setup, ensure you have the following installed:
- [Terraform](https://developer.hashicorp.com/terraform/downloads)
- [Ansible](https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html)
- [AWS CLI](https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html)
- SSH key pair configured in AWS
- Docker & Docker Compose installed (Ansible handles this on the remote instance)

---

## Repository Structure
```
.
├── ansible
│   ├── inventory
│   │   └── hosts.ini  # Inventory file for Ansible
│   ├── playbook.yml   # Ansible playbook
│   └── roles
│       ├── dependencies
│       │   └── tasks
│       │       └── main.yml  # Installs Docker, dependencies
│       └── deployment
│           └── tasks
│               └── main.yml  # Clones repo, runs Docker Compose
├── terraform
│   ├── main.tf        # Terraform configuration file
│   ├── outputs.tf     # Terraform output definitions
│   ├── providers.tf   # Terraform provider configuration
│   ├── variables.tf   # Terraform variable definitions
│   ├── terraform.tfstate  # Terraform state file (auto-generated)
│   ├── ansible
│   │   └── inventory
│   │       └── hosts.ini  # Generated by Terraform
└── README.md  # This file
```

---

## Step 1: Provision Infrastructure with Terraform
1. Navigate to the Terraform directory:
   ```sh
   cd terraform
   ```
2. Initialize Terraform:
   ```sh
   terraform init
   ```
3. Apply the Terraform configuration:
   ```sh
   terraform apply -auto-approve
   ```
4. Once complete, Terraform will output the public IP of the EC2 instance.

---

## Step 2: Configure and Deploy with Ansible
1. Verify that the EC2 instance is reachable:
   ```sh
   ansible -i ansible/inventory/hosts.ini all -m ping
   ```
   If successful, you should see a response with `ping: pong`.
2. Run the Ansible playbook:
   ```sh
   ansible-playbook -i ansible/inventory/hosts.ini ansible/playbook.yml
   ```
   This installs Docker, pulls the application, and runs Docker Compose.

---

## Step 3: Verify Deployment
1. SSH into the EC2 instance:
   ```sh
   ssh -i ~/.ssh/<your-key>.pem ubuntu@<instance-ip>
   ```
2. Check running containers:
   ```sh
   docker ps
   ```
   You should see your application services running.
3. Open the browser and visit:
   ```
   https://fash.zapto.org/
   ```
   Your TODO application should be accessible.

---

## Cleanup
To destroy the infrastructure, run:
```sh
terraform destroy -auto-approve
```
## To run again
```sh
terraform apply -auto-approve
```
---

## Notes
- The `hosts.ini` file is generated dynamically by Terraform and used by Ansible.
- Ensure your security group allows HTTP traffic (port 80) for web access.
- Modify the `playbook.yml` if additional configurations are needed.

---

## Troubleshooting
- **SSH Connection Issues:** Ensure the SSH key permissions are correct:
  ```sh
  chmod 400 ~/.ssh/<your-key>.pem
  ```
- **Terraform Lock File Issue:** If you encounter a dependency lock error, run:
  ```sh
  terraform init -upgrade
 
